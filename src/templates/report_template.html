<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Python Code Analysis Report – {{ file_name }}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 30px; }
        h1, h2, h3 { color: #30103d; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 24px; }
        th, td { border: 1px solid #ccc; padding: 8px; font-size: 14px; }
        th { background: #f4f0f7; }
        .syntax-error { color: #b30000; font-weight: bold; }
        .bar-container { background: #f0f0f0; height: 10px; }
        .bar { background: #7c3aed; height: 10px; }
        .code-block { background: #f7f7f7; padding: 10px; border-radius: 4px; }
    </style>
</head>
<body>

<h1>Python Code Analysis Report</h1>
<p><strong>File:</strong> {{ file_name }}</p>

<h2>Description</h2>
<p>{{ summary }}</p>

<h2>Summary Metrics</h2>
<table>
    <tr><th>Metric</th><th>Value</th></tr>
    <tr><td>Total Lines</td><td>{{ metrics.total_lines }}</td></tr>
    <tr><td>Functions</td><td>{{ metrics.functions }}</td></tr>
    <tr><td>Classes</td><td>{{ metrics.classes }}</td></tr>
    <tr><td>Imports</td><td>{{ metrics.imports }}</td></tr>
    <tr>
        <td>Average Complexity</td>
        <td>
            {% if metrics.avg_complexity is not none %}
                {{ "%.2f"|format(metrics.avg_complexity) }}
            {% else %}
                N/A
            {% endif %}
        </td>
    </tr>
    <tr>
        <td>Maintainability Index</td>
        <td>
            {% if metrics.maintainability is not none %}
                {{ "%.2f"|format(metrics.maintainability) }}
            {% else %}
                N/A
            {% endif %}
        </td>
    </tr>
</table>
<div class="tips-box">
                <h4>Notes & Tips</h4>
                <ul>
                    <li><strong>Average Complexity:</strong> lower = easier to read. High complexity usually means too many conditions or long logic.</li>
                    <li><strong>Maintainability Index:</strong> higher = cleaner code. Values above 70 are considered healthy.</li>
                    <li><strong>Total Lines:</strong> a large file isn't bad, but shorter focused files are usually easier to maintain.</li>
                </ul>
            </div>

<h2>Class Structure</h2>
{% if classes %}
<table>
    <tr>
        <th>Name</th>
        <th>Start Line</th>
        <th>End Line</th>
        <th>LOC</th>
        <th>Methods</th>
    </tr>
    {% for c in classes %}
        <tr>
            <td>{{ c.name }}</td>
            <td>{{ c.line }}</td>
            <td>{{ c.end_line }}</td>
            <td>{{ c.loc }}</td>
            <td>{{ c.methods_count }}</td>
        </tr>
    {% endfor %}
</table>
{% else %}
<p>No classes found.</p>
{% endif %}
<div class="tips-box">
                <h4>Notes & Tips</h4>
                <ul>
                    <li><strong>Lines:</strong> number of lines inside the class. Large classes can sometimes be split into smaller logical pieces.</li>
                    <li><strong>Methods Count:</strong> more methods = more responsibility. Classes should be focused and not do too many things.</li>
                </ul>
            </div>

<h2>Function Structure</h2>
{% if functions %}
<table>
    <tr>
        <th>Name</th>
        <th>Start Line</th>
        <th>End Line</th>
        <th>LOC</th>
        <th>Parameters</th>
        <th>Complexity</th>
    </tr>
    {% for f in functions %}
    <tr>
        <td>{{ f.name }}</td>
        <td>{{ f.line }}</td>
        <td>{{ f.end_line }}</td>
        <td>{{ f.loc }}</td>
        <td>{{ f.args|join(", ") if f.args else "–" }}</td>
        <td>{{ f.complexity if f.complexity else "N/A" }}</td>
    </tr>
    {% endfor %}
</table>
{% else %}
<p>No functions found.</p>
{% endif %}

<div class="tips-box">
    <h4>Notes & Tips</h4>
    <ul>
        <li><strong>Shorter functions</strong> are usually easier to understand and reuse.</li>
        <li><strong>Complexity</strong> increases when you have many if/elif or loops. Try splitting logic when possible.</li>
        <li><strong>Parameters:</strong> functions with too many parameters can be harder to work with.</li>
    </ul>
</div>

<!-- Nesting Depth separate section -->
<h2>Nesting Depth</h2>
{% if metrics.max_nesting is not none %}
<section class="section">
    <h3>Nesting Depth</h3>
    <p>{{ metrics.max_nesting }} levels detected.</p>

    <div class="tips-box">
        <h4>Notes & Tips</h4>
        <ul>
            <li><strong>Nesting</strong> means putting structures inside each other (like an if inside a loop).</li>
            <li>High nesting makes code harder to read — try to flatten logic or use early returns.</li>
        </ul>
    </div>
</section>
{% else %}
<p>Nesting depth not available.</p>
{% endif %}


<h2>Syntax Check</h2>
{% if syntax.error %}
<p class="syntax-error">{{ syntax.error_type }} at line {{ syntax.line }}</p>
<pre class="code-block">{{ syntax.msg }}</pre>
{% else %}
<p>No syntax errors detected.</p>
{% endif %}


<h2>Suggestions</h2>
{% if suggestions %}
<table>
    <tr>
        <th>Line</th>
        <th>Code</th>
        <th>Message</th>
    </tr>
    {% for s in suggestions %}
        <tr>
            <td>{% if s.line %}{{ s.line }}{% else %}–{% endif %}</td>
            <td>{{ s.code }}</td>
            <td>{{ s.message }}</td>
        </tr>
    {% endfor %}
</table>
{% else %}
<p>No style issues detected.</p>
{% endif %}
<div class="tips-box">
                <h4>Notes & Tips</h4>
                <ul>
                    <li>These suggestions come from automated style checks.</li>
                    <li>They help you write cleaner, more consistent code.</li>
                </ul>
            </div>


<h2>Top 10 AST Nodes</h2>

{% if top_nodes %}
<table>
    <tr>
        <th>Node</th>
        <th>Count</th>
    </tr>
    {% for name, count in top_nodes.items() %}
        <tr>
            <td>{{ name }}</td>
            <td>{{ count }}</td>
        </tr>
    {% endfor %}
</table>

<div class="tips-box">
    <h4>Notes & Tips</h4>
    <ul>
        <li><strong>AST Nodes</strong> represent how your code is built internally.</li>
        <li>High counts (like “If”, “Call”, “Assign”) may suggest heavy logic or repeated patterns.</li>
    </ul>
</div>
{% else %}
<p>No nodes found.</p>
{% endif %}

<h2>AST Node Insights</h2>

{% if ast_insights and ast_insights|length > 0 %}
    <div class="ast-insight-box">
        {% for i in ast_insights %}
            <p>• {{ i }}</p>
        {% endfor %}
    </div>
{% else %}
    <p>No unusual AST patterns detected — your code structure looks normal.</p>
{% endif %}

<div class="tips-box">
    <h4>Notes & Tips</h4>
    <ul>
        <li>Insights highlight only patterns that *may* need attention.</li>
        <li>If nothing appears here, your code structure is healthy and easy to follow.</li>
    </ul>
</div>
<h2>Overall Quality Score</h2>
{% set score = quality_percent %}
{% if score >= 80 %}
    {% set quality_class = "quality-good" %}
{% elif score >= 50 %}
    {% set quality_class = "quality-medium" %}
{% else %}
    {% set quality_class = "quality-poor" %}
{% endif %}

<div class="quality-wrapper">
    <div class="quality-track">
        <div class="quality-bar {{ quality_class }}" style="width: {{ score }}%;"></div>
    </div>
    <p class="quality-label">{{ quality_label }} ({{ score }}%)</p>
</div>

</body>
</html>
