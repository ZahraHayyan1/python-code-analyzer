<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Analysis Results – {{ file_name }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<header>
    <h1>Python Code Analyzer</h1>
</header>

<div class="container">
    <div class="card report-card">

        <h2 class="section-title">Analysis Results</h2>
        <p class="file-name">File: <span>{{ file_name }}</span></p>

        <section class="section">
            <h3>Summary Metrics</h3>
            <table class="metrics-table">
                <tr>
                    <th>Metric</th>
                    <th>Value</th>
                </tr>
                <tr>
                    <td>Total Lines</td>
                    <td>{{ metrics.total_lines }}</td>
                </tr>
                <tr>
                    <td>Functions</td>
                    <td>{{ metrics.functions }}</td>
                </tr>
                <tr>
                    <td>Classes</td>
                    <td>{{ metrics.classes }}</td>
                </tr>
                <tr>
                    <td>Imports</td>
                    <td>{{ metrics.imports }}</td>
                </tr>
                <tr>
                    <td>Average Complexity</td>
                    <td>
                        {% if metrics.avg_complexity is not none %}
                            {{ "%.2f"|format(metrics.avg_complexity) }}  
                            <br><small>Lower is better — reduce branching (if/for) to improve.</small>
                        {% else %}
                            N/A
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <td>Maintainability Index</td>
                    <td>
                        {% if metrics.maintainability is not none %}
                            {{ "%.2f"|format(metrics.maintainability) }}
                            <br><small>Higher is better — simplify long functions to improve.</small>
                        {% else %}
                            N/A
                        {% endif %}
                    </td>
                </tr>
            </table>
        </section>

        <section class="section">
            <h3>Detailed Class Structure</h3>
            {% if classes %}
                <table class="detail-table">
                    <tr>
                        <th>Name</th>
                        <th>Start Line</th>
                        <th>End Line</th>
                        <th>LOC</th>
                        <th>Methods</th>
                    </tr>
                    {% for c in classes %}
                        <tr>
                            <td>{{ c.name }}</td>
                            <td>{{ c.line }}</td>
                            <td>{{ c.end_line }}</td>
                            <td>{{ c.loc }} <br><small>LOC = Lines of Code</small></td>
                            <td>{{ c.methods_count }}</td>
                        </tr>
                    {% endfor %}
                </table>
            {% else %}
                <p>No classes found.</p>
            {% endif %}
        </section>

        <section class="section">
            <h3>Detailed Function Structure</h3>
            {% if functions %}
                <table class="detail-table">
                    <tr>
                        <th>Name</th>
                        <th>Start Line</th>
                        <th>End Line</th>
                        <th>LOC</th>
                        <th>Parameters</th>
                        <th>Complexity</th>
                    </tr>
                    {% for f in functions %}
                        <tr>
                            <td>{{ f.name }}</td>
                            <td>{{ f.line }}</td>
                            <td>{{ f.end_line }}</td>
                            <td>{{ f.loc }} <br><small>Shorter functions are easier to maintain.</small></td>
                            <td>
                                {% if f.args %}
                                    {{ f.args|join(", ") }}
                                {% else %}
                                    –
                                {% endif %}
                            </td>
                            <td>
                                {% if f.complexity is not none %}
                                    {{ f.complexity }}
                                {% else %}
                                    N/A
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </table>
            {% else %}
                <p>No functions found.</p>
            {% endif %}
        </section>

        <section class="section">
            <h3>Nesting Analysis</h3>
            <p><strong>{{ metrics.max_nesting }}</strong> levels of nesting detected.</p>
            <p><small>Lower nesting improves readability — try flattening nested if/loops.</small></p>
        </section>

        <section class="section">
            <h3>Syntax Errors</h3>
            {% if syntax.error %}
                <p class="syntax-error">
                    {{ syntax.error_type }} at line {{ syntax.line }}
                </p>
                <pre class="code-block">{{ syntax.msg }}</pre>
            {% else %}
                <p>No syntax errors detected.</p>
            {% endif %}
        </section>

        <section class="section">
            <h3>Suggestions and Recommendations</h3>
            {% if suggestions %}
                <table class="detail-table">
                    <tr>
                        <th>Line</th>
                        <th>Code</th>
                        <th>Message</th>
                    </tr>
                    {% for s in suggestions %}
                        <tr>
                            <td>
                                {% if s.line %}
                                    {{ s.line }}
                                {% else %}
                                    –
                                {% endif %}
                            </td>
                            <td>{{ s.code }}</td>
                            <td>{{ s.message }}</td>
                        </tr>
                    {% endfor %}
                </table>
            {% else %}
                <p>No style warnings or suggestions.</p>
            {% endif %}
        </section>

        <section class="section">
            <h3>AST Node Overview</h3>
            <p><small>This shows how your code is structured internally.</small></p>

            {% if nodes %}
                <div class="ast-box">
                    {% for name, count in nodes.items() %}
                        <div class="ast-item">
                            <strong>{{ name }}</strong>: 
                            <span class="ast-count">{{ count }}</span>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p>No AST nodes to display.</p>
            {% endif %}
        </section>

        <section class="section">
            <h3>Overall Code Quality Score</h3>
            <div class="quality-score-container">
                <div class="quality-bar-wrapper">
                    <div class="quality-bar {{ quality_color }}" style="width: {{ quality_percent }}%;">
                    </div>
                </div>
                <div class="quality-label">{{ quality_label }} ({{ quality_percent }}%)</div>
            </div>
        </section>

        <div class="buttons-row">
            <a href="{{ url_for('download_report', filename=report_file) }}" class="upload-btn">
                Download Report
            </a>

            <a href="{{ url_for('upload_page') }}" class="upload-btn secondary-btn">
                Upload Another File
            </a>
        </div>

    </div>
</div>

</body>
</html>

